name: Test

runs:
  using: composite
  steps:
    - name: Unit tests
      shell: bash
      run: ctest --test-dir ${{ env.CMAKE_BUILD_DIR }}

    - name: Prepare integration tests env
      shell: bash
      run: |
        sudo su
        pip install -r "${{ env.TEST_PATH }}/requirements.txt"

    - name: Integration tests
      shell: bash
      run: |
        sudo su
        chmod +rwx "${{ env.DISCOVERY_BIN_PATH }}"
        pytest "${{ env.TEST_PATH }}" --discovery_path="${{ env.DISCOVERY_BIN_PATH }}"
