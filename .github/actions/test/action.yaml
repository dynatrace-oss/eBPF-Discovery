name: Test

runs:
  using: composite
  steps:
    - name: Unit tests
      shell: bash
      run: ctest --test-dir ${{ env.CMAKE_BUILD_DIR }}

    - name: Prepare integration tests env
      shell: bash
      run: |
        sudo su
        pip install -r "${{ env.TEST_PATH }}/requirements.txt"

    - name: Integration tests
      shell: bash
      run: |
        sudo su
        cd "${{ env.TEST_PATH }}"
        echo DEBUG
        find "${{ github.workspace }}" -name ebpfdiscoverysrv
        pytest --discovery_path="${{ env.CMAKE_BUILD_DIR }}/bin/ebpfdiscoverysrv"
